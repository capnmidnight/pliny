<!DOCTYPE html>
<html>
  <head>
    <title>Test formatting</title><!-- LIVE RELOADER -->
<script src="node_modules/socket.io-client/dist/socket.io.js"></script>
<script>
(function(path) {

function mangle(name) {
  return "_" + name;
}

function wrapFunction(send, name) {
  var orig = name;
  while (console[orig]) {
    orig = mangle(orig);
  }
  if (console[name]) {
    console[orig] = console[name];
  } else {
    orig = null;
  }
  console[name] = function () {
    var args = [];
    for (var i = 0; i < arguments.length; ++i) {
      var elem = arguments[i];
      if (elem === null) {
        args.push("null");
      } else if (elem === undefined) {
        args.push("undefined");
      } else if (typeof elem === "object" && !(elem instanceof String)) {
        var obj1 = elem,
            obj2 = {};
        for (var key in obj1) {
          obj2[key] = obj1[key];
          if (obj2[key] !== null && obj2[key] !== undefined) {
            obj2[key] = obj2[key].toString();
          }
        }
        args.push(obj2);
      } else {
        args.push(elem.toString());
      }
    }

    var obj = send({ name: name, args: args });
    if (orig && console[orig] && obj) {
      console[orig].apply(console, arguments);
    }
  };
}

var isBad = location.protocol === "file:",
  send = isBad ? function identity(data) {
      return data;
    } : function (data) {
      socket.emit("logging", data);
      return data;
    },
  redirects = ["log", "info", "error"],
  status = "enabled.",
  socket = io(path)
    .on("connect", function() {
      console.log("Live reload " + status);
      status = "reestablished.";
    })
    .on("stop", function() { dispatchEvent(new CustomEvent("stop")); })
    .on("reload", function() { location.reload(); })
    .on("command", function(cmd) {
      console._log(cmd);
      console.log(eval(cmd));
    });

if (isBad) {
  console.warn("Can't perform HTTP requests from the file system. Not going to setup the error proxy, but will setup the error catch-all.");
}

redirects.forEach(function (name) {
  return wrapFunction(send, name);
});

window.addEventListener("error", function (evt) {
  var colno = evt.colno || window.event && window.event.errorCharacter,
      done = false,
      err = evt.error,
      stack = err && err.stack;

  if (!stack) {
    if (arguments.callee) {
      var head = arguments.callee.caller;
      while (head) {
        stack.push(head.name);
        head = head.caller;
      }
    } else {
      stack = "N/A";
    }
  }

  var data = {
    type: "error",
    time: new Date().toLocaleTimeString(),
    message: evt.message,
    source: evt.filename,
    lineno: evt.lineno,
    colno: colno,
    error: err && err.message,
    stack: stack
  };

  try {
    send({name: "error", args: [data]});
  } catch (exp) {
  }
}, false);

})(location.origin.replace(/^http/, "ws"));
</script>

  </head>
  <body>
    <pre></pre>
  </body>
  <script src="testFormatting.js"></script>
</html>